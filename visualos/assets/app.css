/* ============================================================
   Visual Layout OS — app.css
   IDE-style dark UI for CoreSystem 3.0
   ============================================================ */

/* ── 1. Design Tokens ─────────────────────────────────────── */
:root {
  /* Surfaces */
  --bg:          #0d1117;
  --surface:     #161b22;
  --surface-2:   #21262d;
  --surface-3:   #30363d;
  --border:      #30363d;
  --border-2:    #3d444d;

  /* Text */
  --text:        #e6edf3;
  --text-muted:  #7d8590;
  --text-subtle: #484f58;

  /* Accent */
  --accent:      #58a6ff;
  --accent-hover:#79c0ff;
  --accent-dim:  #1f3658;
  --success:     #3fb950;
  --warning:     #d29922;
  --danger:      #f85149;

  /* Artboard */
  --artboard-bg:  #0d1117;
  --artboard-dot: #21262d;

  /* Panel widths */
  --panel-layers:   220px;
  --panel-inspect:  256px;
  --toolbar-h:      48px;
  --ruler-size:     20px;

  /* Typography */
  --font: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  --mono: 'Cascadia Code', 'Fira Code', 'Consolas', monospace;
  --text-xs:  11px;
  --text-sm:  12px;
  --text-base:13px;

  /* Misc */
  --radius-sm: 4px;
  --radius-md: 6px;
  --radius-lg: 10px;
  --transition: 150ms ease;
}

/* Light theme override */
[data-theme="light"] {
  --bg:         #f6f8fa;
  --surface:    #ffffff;
  --surface-2:  #f0f2f5;
  --surface-3:  #e1e4e8;
  --border:     #d0d7de;
  --border-2:   #bbc0c7;
  --text:       #1f2328;
  --text-muted: #636c76;
  --text-subtle:#818b99;
  --artboard-bg:#f0f2f5;
  --artboard-dot:#d0d7de;
}

/* ── 2. Reset ─────────────────────────────────────────────── */
*, *::before, *::after { box-sizing:border-box; margin:0; padding:0; }
html, body { height:100%; overflow:hidden; }
body {
  font-family: var(--font);
  font-size:   var(--text-base);
  color:       var(--text);
  background:  var(--bg);
  -webkit-font-smoothing: antialiased;
}
button { cursor:pointer; border:none; background:none; color:inherit; font:inherit; }
input, select, textarea { font:inherit; color:inherit; }

/* ── 3. App Shell ─────────────────────────────────────────── */
#vlos-app {
  display:    grid;
  grid-template-rows: var(--toolbar-h) 1fr;
  grid-template-columns: var(--ruler-size) var(--panel-layers) 1fr var(--panel-inspect);
  grid-template-areas:
    "toolbar toolbar toolbar toolbar"
    "ruler-v layers canvas inspect";
  height: 100vh;
  overflow: hidden;
}

/* ── 4. Toolbar ───────────────────────────────────────────── */
#vlos-toolbar {
  grid-area:       toolbar;
  display:         flex;
  align-items:     center;
  gap:             4px;
  padding:         0 12px;
  background:      var(--surface);
  border-bottom:   1px solid var(--border);
  height:          var(--toolbar-h);
  z-index:         100;
}

.toolbar__logo {
  font-weight: 700;
  font-size:   14px;
  color:       var(--accent);
  text-decoration: none;
  padding:     0 8px 0 0;
  margin-right:4px;
  border-right: 1px solid var(--border);
}

.toolbar__group {
  display:    flex;
  align-items:center;
  gap:        2px;
  padding:    0 6px;
  border-right: 1px solid var(--border);
}
.toolbar__group:last-child { border-right:none; margin-left:auto; }
.toolbar__group--right { margin-left:auto; border-left:1px solid var(--border); border-right:none; }

.toolbar__tools { gap:0; }

.toolbar__tool {
  display:     flex;
  align-items: center;
  justify-content: center;
  width:       32px;
  height:      32px;
  border-radius: var(--radius-sm);
  font-size:   16px;
  color:       var(--text-muted);
  transition:  background var(--transition), color var(--transition);
}
.toolbar__tool:hover { background:var(--surface-2); color:var(--text); }
.toolbar__tool.is-active { background:var(--accent-dim); color:var(--accent); }

.toolbar__btn {
  padding:     4px 8px;
  border-radius: var(--radius-sm);
  font-size:   var(--text-sm);
  color:       var(--text-muted);
  border:      1px solid transparent;
  transition:  all var(--transition);
}
.toolbar__btn:hover { background:var(--surface-2); color:var(--text); border-color:var(--border); }
.toolbar__btn:disabled { opacity:.4; cursor:not-allowed; }
.toolbar__btn--icon { width:28px; padding:0; text-align:center; font-size:14px; }
.toolbar__btn--sm { font-size:11px; padding:2px 6px; }
.toolbar__btn--primary {
  background:  var(--accent);
  color:       #000;
  border-color:var(--accent);
  font-weight: 600;
}
.toolbar__btn--primary:hover { background:var(--accent-hover); border-color:var(--accent-hover); }

.toolbar__zoom-label {
  font-size:  var(--text-sm);
  min-width:  40px;
  text-align: center;
  color:      var(--text-muted);
  user-select:none;
}

.toolbar__toggle {
  display:    flex;
  align-items:center;
  gap:        4px;
  font-size:  var(--text-sm);
  color:      var(--text-muted);
  cursor:     pointer;
}
.toolbar__toggle input { accent-color:var(--accent); width:14px; height:14px; }

/* ── 5. Ruler ─────────────────────────────────────────────── */
#vlos-ruler-v {
  grid-area:   ruler-v;
  background:  var(--surface);
  border-right:1px solid var(--border);
  position:    relative;
  overflow:    hidden;
  font-size:   9px;
  color:       var(--text-subtle);
}
.ruler-tick {
  position: absolute;
  line-height:1;
  white-space:nowrap;
}
#vlos-ruler-v .ruler-tick {
  writing-mode: vertical-rl;
  transform: rotate(180deg);
  left: 2px;
}

/* ── 6. Layers Panel ──────────────────────────────────────── */
#vlos-layers {
  grid-area:    layers;
  display:      flex;
  flex-direction:column;
  background:   var(--surface);
  border-right: 1px solid var(--border);
  overflow:     hidden;
}

.layers__header {
  display:      flex;
  align-items:  center;
  justify-content: space-between;
  padding:      8px 10px;
  font-size:    var(--text-xs);
  font-weight:  600;
  text-transform: uppercase;
  letter-spacing:.05em;
  color:        var(--text-muted);
  border-bottom:1px solid var(--border);
}
.layers__btn-sm {
  font-size:   14px;
  color:       var(--text-muted);
  padding:     0 4px;
  border-radius: var(--radius-sm);
}
.layers__btn-sm:hover { background:var(--surface-2); color:var(--text); }

.layers__list {
  flex:    1;
  overflow-y: auto;
  overflow-x: hidden;
}
.layers__empty {
  padding:    20px 12px;
  color:      var(--text-muted);
  font-size:  var(--text-sm);
  line-height:1.6;
  text-align: center;
}

.layer {
  display:     flex;
  align-items: center;
  gap:         4px;
  padding:     5px 8px;
  cursor:      pointer;
  border-bottom: 1px solid transparent;
  transition:  background var(--transition);
  user-select: none;
  min-height:  30px;
}
.layer:hover { background:var(--surface-2); }
.layer.is-selected { background:var(--accent-dim); }
.layer.is-locked .layer__name { opacity:.5; }
.layer.is-hidden { opacity:.5; }
.layer.is-context { outline:1px solid var(--accent); }

.layer__expand {
  width:  14px;
  min-width:14px;
  font-size:10px;
  color:  var(--text-muted);
}
.layer__expand--leaf { opacity:0; pointer-events:none; }

.layer__icon { font-size:11px; color:var(--text-muted); }

.layer__name {
  flex:      1;
  font-size: var(--text-sm);
  overflow:  hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.layer__rename-input {
  flex:       1;
  background: var(--surface-3);
  border:     1px solid var(--accent);
  border-radius: var(--radius-sm);
  padding:    1px 4px;
  font-size:  var(--text-sm);
  outline:    none;
  color:      var(--text);
}

.layer__role {
  font-size:  9px;
  background: var(--surface-3);
  color:      var(--text-muted);
  padding:    1px 5px;
  border-radius: 10px;
  text-transform:lowercase;
}

.layer__actions {
  display:  none;
  gap:      2px;
}
.layer:hover .layer__actions { display:flex; }

.layer__btn {
  font-size:   12px;
  padding:     1px 3px;
  border-radius:var(--radius-sm);
  color:       var(--text-muted);
}
.layer__btn:hover { background:var(--surface-3); color:var(--text); }
.layer__btn.is-on { color:var(--warning); }
.layer__btn--danger:hover { background:rgba(248,81,73,.15); color:var(--danger); }

/* ── 7. Canvas Area ───────────────────────────────────────── */
#vlos-canvas-area {
  grid-area:  canvas;
  display:    grid;
  grid-template-rows: var(--ruler-size) 1fr;
  overflow:   hidden;
  position:   relative;
}

#vlos-ruler-h {
  background:  var(--surface);
  border-bottom:1px solid var(--border);
  position:    relative;
  overflow:    hidden;
  font-size:   9px;
  color:       var(--text-subtle);
}
#vlos-ruler-h .ruler-tick {
  position:absolute;
  top:2px;
}

#vlos-canvas {
  position:   relative;
  overflow:   hidden;
  background: var(--artboard-bg);
  background-image:
    radial-gradient(circle, var(--artboard-dot) 1px, transparent 1px);
  background-size: 24px 24px;
  cursor:     crosshair;
}
#vlos-canvas.hand-mode { cursor:grab; }
#vlos-canvas.hand-mode:active { cursor:grabbing; }

/* Artboard wrap (transform target) */
#vlos-artboard-wrap {
  position:        absolute;
  transform-origin:0 0;
  transition:      none;
}

/* Artboard */
#vlos-artboard {
  position:   relative;
  background: #ffffff;
  box-shadow: 0 4px 40px rgba(0,0,0,.6);
}

/* Grid overlay */
#vlos-artboard.show-grid::before {
  content:'';
  position:absolute;
  inset:0;
  pointer-events:none;
  background-image:
    linear-gradient(to right, rgba(88,166,255,.08) 1px, transparent 1px),
    linear-gradient(to bottom, rgba(88,166,255,.08) 1px, transparent 1px);
  background-size: 8px 8px;
  z-index: 9999;
}

/* Canvas elements */
.canvas-el {
  box-sizing:   border-box;
  transition:   none;
}
.canvas-el:hover { outline:1px dashed rgba(88,166,255,.6); }
.canvas-el.is-selected { outline:2px solid var(--accent) !important; }
.canvas-el.is-locked { cursor:not-allowed !important; }

/* Element label (role debug) */
.el-label {
  position:   absolute;
  top:        4px;
  left:       4px;
  font-size:  9px;
  font-family:var(--mono);
  background: rgba(0,0,0,.5);
  color:      #fff;
  padding:    1px 4px;
  border-radius:3px;
  pointer-events:none;
  user-select:none;
}

/* ── 8. Selection Handles ─────────────────────────────────── */
.resize-handle {
  position:       absolute;
  background:     #fff;
  border:         2px solid var(--accent);
  border-radius:  2px;
  z-index:        10000;
  cursor:         pointer;
  pointer-events: all;
}
.handle-nw { cursor:nw-resize; }
.handle-n  { cursor:n-resize;  }
.handle-ne { cursor:ne-resize; }
.handle-e  { cursor:e-resize;  }
.handle-se { cursor:se-resize; }
.handle-s  { cursor:s-resize;  }
.handle-sw { cursor:sw-resize; }
.handle-w  { cursor:w-resize;  }

.size-label {
  position:    absolute;
  font-size:   10px;
  font-family: var(--mono);
  color:       var(--accent);
  background:  var(--surface);
  padding:     1px 5px;
  border-radius:3px;
  pointer-events:none;
  user-select: none;
  z-index:     10001;
  white-space: nowrap;
}

/* ── 9. Snap Guides ───────────────────────────────────────── */
#vlos-guides {
  position:       absolute;
  inset:          0;
  pointer-events: none;
  z-index:        9998;
}

.snap-guide {
  position: absolute;
  background: #f05;
  opacity: .8;
}
.snap-guide--center { background:#58a6ff; }
.snap-guide--artboard-center { background:#3fb950; }
.snap-guide--artboard-edge { background:#d29922; }
.snap-guide--spacing {
  background:  transparent;
  border:      1px dashed #f05;
}

/* ── 10. Rubber Band ──────────────────────────────────────── */
.rubber-band {
  position:   absolute;
  border:     1px solid var(--accent);
  background: rgba(88,166,255,.1);
  pointer-events:none;
  z-index:    9997;
}

/* ── 11. Inspector Panel ──────────────────────────────────── */
#vlos-inspector {
  grid-area:   inspect;
  display:     flex;
  flex-direction:column;
  background:  var(--surface);
  border-left: 1px solid var(--border);
  overflow-y:  auto;
  overflow-x:  hidden;
}

.inspector__section {
  padding:     10px 12px;
  border-bottom: 1px solid var(--border);
}
.inspector__title {
  font-size:   var(--text-sm);
  font-weight: 600;
  margin-bottom:6px;
  display:     flex;
  align-items: center;
  gap:         6px;
}
.inspector__tag {
  font-size:   10px;
  background:  var(--surface-3);
  color:       var(--text-muted);
  padding:     1px 6px;
  border-radius:10px;
  font-weight: 400;
}
.inspector__group-title {
  font-size:   10px;
  font-weight: 600;
  text-transform:uppercase;
  letter-spacing:.05em;
  color:       var(--text-muted);
  margin-bottom:6px;
}
.inspector__hint {
  font-size:  var(--text-sm);
  color:      var(--text-muted);
  line-height:1.5;
}
.inspector__row {
  display:     flex;
  align-items: center;
  gap:         6px;
  margin-bottom:5px;
  font-size:   var(--text-sm);
}
.inspector__row label {
  min-width:  52px;
  color:      var(--text-muted);
  font-size:  var(--text-xs);
}
.inspector__row input[type="number"],
.inspector__row input[type="text"],
.inspector__row select {
  flex:       1;
  background: var(--surface-2);
  border:     1px solid var(--border);
  border-radius: var(--radius-sm);
  padding:    3px 6px;
  color:      var(--text);
  font-size:  var(--text-sm);
  outline:    none;
  min-width:  0;
}
.inspector__row input:focus,
.inspector__row select:focus { border-color:var(--accent); }
.inspector__row input[type="color"] {
  width:  32px;
  height: 24px;
  padding:0;
  border: 1px solid var(--border);
  border-radius:var(--radius-sm);
  cursor:pointer;
  background:none;
}
.inspector__row input[type="range"] {
  flex:     1;
  accent-color: var(--accent);
}

.inspector__grid2 {
  display:               grid;
  grid-template-columns: 1fr 1fr;
  gap:                   5px;
}
.inspector__grid2 label {
  display:     flex;
  flex-direction:column;
  gap:         2px;
  font-size:   10px;
  color:       var(--text-muted);
}
.inspector__grid2 label input {
  background:  var(--surface-2);
  border:      1px solid var(--border);
  border-radius:var(--radius-sm);
  padding:     3px 6px;
  color:       var(--text);
  font-size:   var(--text-sm);
  width:       100%;
  outline:     none;
}

.inspector__btn {
  padding:     4px 8px;
  font-size:   var(--text-xs);
  border-radius:var(--radius-sm);
  border:      1px solid var(--border);
  background:  var(--surface-2);
  color:       var(--text-muted);
  transition:  all var(--transition);
}
.inspector__btn:hover { border-color:var(--border-2); color:var(--text); }
.inspector__btn--danger:hover { border-color:var(--danger); color:var(--danger); }

/* Constraints */
.constraint-grid {
  display:  flex;
  gap:      8px;
}
.constraint-box {
  display:  flex;
  flex-wrap:wrap;
  gap:      3px;
  flex:     1;
}
.constraint-btn {
  width:    28px;
  height:   24px;
  font-size:13px;
  border-radius:var(--radius-sm);
  border:   1px solid var(--border);
  background:var(--surface-2);
  color:    var(--text-muted);
  transition:all var(--transition);
}
.constraint-btn:hover { border-color:var(--border-2); color:var(--text); }
.constraint-btn.is-active { background:var(--accent-dim); border-color:var(--accent); color:var(--accent); }

/* Token editor */
.inspector__section--tokens details summary { list-style:none; }
.token-category { margin-bottom:8px; }
.token-category__label {
  font-size:  10px;
  font-weight:600;
  text-transform:uppercase;
  color:      var(--text-subtle);
  margin-bottom:4px;
  letter-spacing:.04em;
}

/* ── 12. Preview Modal ────────────────────────────────────── */
#vlos-preview-modal {
  position:   fixed;
  inset:      0;
  background: rgba(0,0,0,.85);
  z-index:    9999;
  display:    flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  padding:    12px;
  opacity:    0;
  pointer-events:none;
  transition: opacity 200ms ease;
}
#vlos-preview-modal.is-open {
  opacity:    1;
  pointer-events:all;
}

.preview-modal__bar {
  display:    flex;
  align-items:center;
  gap:        8px;
  margin-bottom:10px;
  background: var(--surface);
  border:     1px solid var(--border);
  border-radius:var(--radius-lg);
  padding:    6px 12px;
  width:      100%;
  max-width:  800px;
}
.preview-modal__title {
  font-size:  14px;
  font-weight:600;
  color:      var(--text);
  margin-right:auto;
}
.preview-modal__sizes {
  display:flex;
  gap:4px;
}
.preview-modal__size-btn {
  padding:    3px 8px;
  font-size:  11px;
  border-radius:var(--radius-sm);
  border:     1px solid var(--border);
  background: var(--surface-2);
  color:      var(--text-muted);
  transition: all var(--transition);
}
.preview-modal__size-btn.is-active { border-color:var(--accent); color:var(--accent); background:var(--accent-dim); }
.preview-modal__size-btn:hover { color:var(--text); border-color:var(--border-2); }

.preview-modal__iframe-wrap {
  flex:     1;
  display:  flex;
  align-items:flex-start;
  justify-content:center;
  overflow: auto;
  width:    100%;
}

#vlos-preview-iframe {
  border:    none;
  background:#fff;
  border-radius:var(--radius-md);
  box-shadow: 0 8px 48px rgba(0,0,0,.6);
  display:   block;
}

/* ── 13. Context Menu ─────────────────────────────────────── */
#vlos-context-menu {
  position:   fixed;
  background: var(--surface);
  border:     1px solid var(--border);
  border-radius:var(--radius-md);
  box-shadow: 0 8px 24px rgba(0,0,0,.4);
  z-index:    99999;
  min-width:  160px;
  padding:    4px 0;
  font-size:  var(--text-sm);
  display:    none;
}
#vlos-context-menu.is-open { display:block; }
.context-menu__item {
  padding:    7px 14px;
  cursor:     pointer;
  display:    flex;
  align-items:center;
  gap:        8px;
  color:      var(--text);
  transition: background var(--transition);
}
.context-menu__item:hover { background:var(--surface-2); }
.context-menu__item--danger:hover { background:rgba(248,81,73,.1); color:var(--danger); }
.context-menu__sep {
  height:     1px;
  background: var(--border);
  margin:     4px 0;
}

/* ── 14. Toast ────────────────────────────────────────────── */
.vlos-toast {
  position:   fixed;
  bottom:     24px;
  left:       50%;
  transform:  translateX(-50%) translateY(12px);
  background: var(--surface-3);
  color:      var(--text);
  padding:    8px 16px;
  border-radius:var(--radius-md);
  font-size:  var(--text-sm);
  z-index:    999999;
  opacity:    0;
  transition: opacity 250ms ease, transform 250ms ease;
  pointer-events:none;
  border:     1px solid var(--border);
}
.vlos-toast.is-visible {
  opacity:   1;
  transform: translateX(-50%) translateY(0);
}

/* ── 15. Scrollbars ───────────────────────────────────────── */
::-webkit-scrollbar { width:6px; height:6px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:var(--surface-3); border-radius:3px; }
::-webkit-scrollbar-thumb:hover { background:var(--border-2); }

/* ── 16. Utilities ────────────────────────────────────────── */
.visually-hidden { position:absolute; width:1px; height:1px; overflow:hidden; clip:rect(0,0,0,0); }

/* Artboard label */
.artboard-label {
  position:   absolute;
  top:        -24px;
  left:       0;
  font-size:  11px;
  color:      var(--text-muted);
  font-family:var(--mono);
  pointer-events:none;
  user-select:none;
  white-space:nowrap;
}
